function getZoneNumber(a,b){a=parseFloat(a),((b=parseFloat(b))>360||b<-180||a>84||a<-80)&&alert("usng.js, getZoneNumber: invalid input. lat: "+a.toFixed(4)+" lon: "+b.toFixed(4));var c=b+180-360*parseInt((b+180)/360)-180,d=parseInt((c+180)/6)+1;return a>=56&&a<64&&c>=3&&c<12&&(d=32),a>=72&&a<84&&(c>=0&&c<9?d=31:c>=9&&c<21?d=33:c>=21&&c<33?d=35:c>=33&&c<42&&(d=37)),d}function LLtoUTM(a,b,c,d){if(a=parseFloat(a),b=parseFloat(b),a>84||a<-80)return UNDEFINED_STR;(b>360||b<-180||a>90||a<-90)&&alert("usng.js, LLtoUTM, invalid input. lat: "+a.toFixed(4)+" lon: "+b.toFixed(4)),lonTemp=b+180-360*parseInt((b+180)/360)-180,latRad=a*DEG_2_RAD,lonRad=lonTemp*DEG_2_RAD,zoneNumber=d||getZoneNumber(a,b),lonOrigin=6*(zoneNumber-1)-180+3,lonOriginRad=lonOrigin*DEG_2_RAD,UTMZone=zoneNumber+""+UTMLetterDesignator(a)+" ",N=EQUATORIAL_RADIUS/Math.sqrt(1-ECC_SQUARED*Math.sin(latRad)*Math.sin(latRad)),T=Math.tan(latRad)*Math.tan(latRad),C=ECC_PRIME_SQUARED*Math.cos(latRad)*Math.cos(latRad),A=Math.cos(latRad)*(lonRad-lonOriginRad),M=EQUATORIAL_RADIUS*((1-ECC_SQUARED/4-ECC_SQUARED*ECC_SQUARED*3/64-ECC_SQUARED*ECC_SQUARED*ECC_SQUARED*5/256)*latRad-(3*ECC_SQUARED/8+3*ECC_SQUARED*ECC_SQUARED/32+45*ECC_SQUARED*ECC_SQUARED*ECC_SQUARED/1024)*Math.sin(2*latRad)+(15*ECC_SQUARED*ECC_SQUARED/256+45*ECC_SQUARED*ECC_SQUARED*ECC_SQUARED/1024)*Math.sin(4*latRad)-35*ECC_SQUARED*ECC_SQUARED*ECC_SQUARED/3072*Math.sin(6*latRad)),UTMEasting=k0*N*(A+(1-T+C)*(A*A*A)/6+(5-18*T+T*T+72*C-58*ECC_PRIME_SQUARED)*(A*A*A*A*A)/120)+EASTING_OFFSET,UTMNorthing=k0*(M+N*Math.tan(latRad)*(A*A/2+(5-T+9*C+4*C*C)*(A*A*A*A)/24+(61-58*T+T*T+600*C-330*ECC_PRIME_SQUARED)*(A*A*A*A*A*A)/720)),c[0]=UTMEasting,c[1]=UTMNorthing,c[2]=zoneNumber}function LLtoUSNG(a,b,c){b<-180?b+=360:b>180&&(b-=360),a=parseFloat(a),b=parseFloat(b);var d=[];LLtoUTM(a,b,d);var e=d[0],f=d[1];for(a<0&&(f+=NORTHING_OFFSET),USNGLetters=findGridLetters(zoneNumber,f,e),USNGNorthing=Math.round(f)%BLOCK_SIZE,USNGEasting=Math.round(e)%BLOCK_SIZE,USNGNorthing=Math.floor(USNGNorthing/Math.pow(10,5-c)),USNGEasting=Math.floor(USNGEasting/Math.pow(10,5-c)),USNG=getZoneNumber(a,b)+UTMLetterDesignator(a)+" "+USNGLetters+" ",i=String(USNGEasting).length;i<c;i++)USNG+="0";for(USNG+=USNGEasting+" ",i=String(USNGNorthing).length;i<c;i++)USNG+="0";return USNG+=USNGNorthing,USNG}function UTMLetterDesignator(a){return a=parseFloat(a),letterDesignator=84>=a&&a>=72?"X":72>a&&a>=64?"W":64>a&&a>=56?"V":56>a&&a>=48?"U":48>a&&a>=40?"T":40>a&&a>=32?"S":32>a&&a>=24?"R":24>a&&a>=16?"Q":16>a&&a>=8?"P":8>a&&a>=0?"N":0>a&&a>=-8?"M":-8>a&&a>=-16?"L":-16>a&&a>=-24?"K":-24>a&&a>=-32?"J":-32>a&&a>=-40?"H":-40>a&&a>=-48?"G":-48>a&&a>=-56?"F":-56>a&&a>=-64?"E":-64>a&&a>=-72?"D":-72>a&&a>=-80?"C":"Z",letterDesignator}function findSet(a){switch(a=parseInt(a),a%=6){case 0:return 6;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;case 5:return 5;default:return-1}}function findGridLetters(a,b,c){for(a=parseInt(a),b=parseFloat(b),c=parseFloat(c),row=1,north_1m=Math.round(b);north_1m>=BLOCK_SIZE;)north_1m-=BLOCK_SIZE,row++;for(row%=GRIDSQUARE_SET_ROW_SIZE,col=0,east_1m=Math.round(c);east_1m>=BLOCK_SIZE;)east_1m-=BLOCK_SIZE,col++;return col%=GRIDSQUARE_SET_COL_SIZE,lettersHelper(findSet(a),row,col)}function lettersHelper(a,b,c){switch(0==b?b=GRIDSQUARE_SET_ROW_SIZE-1:b--,0==c?c=GRIDSQUARE_SET_COL_SIZE-1:c--,a){case 1:return l1="ABCDEFGH",l2="ABCDEFGHJKLMNPQRSTUV",l1.charAt(c)+l2.charAt(b);case 2:return l1="JKLMNPQR",l2="FGHJKLMNPQRSTUVABCDE",l1.charAt(c)+l2.charAt(b);case 3:return l1="STUVWXYZ",l2="ABCDEFGHJKLMNPQRSTUV",l1.charAt(c)+l2.charAt(b);case 4:return l1="ABCDEFGH",l2="FGHJKLMNPQRSTUVABCDE",l1.charAt(c)+l2.charAt(b);case 5:return l1="JKLMNPQR",l2="ABCDEFGHJKLMNPQRSTUV",l1.charAt(c)+l2.charAt(b);case 6:return l1="STUVWXYZ",l2="FGHJKLMNPQRSTUVABCDE",l1.charAt(c)+l2.charAt(b)}}function UTMtoLL(a,b,c,d){var e=parseFloat(b)-EASTING_OFFSET,f=parseFloat(a),g=parseInt(c),h=6*(g-1)-180+3,i=f/k0,j=i/(EQUATORIAL_RADIUS*(1-ECC_SQUARED/4-3*ECC_SQUARED*ECC_SQUARED/64-5*ECC_SQUARED*ECC_SQUARED*ECC_SQUARED/256)),k=j+(3*E1/2-27*E1*E1*E1/32)*Math.sin(2*j)+(21*E1*E1/16-55*E1*E1*E1*E1/32)*Math.sin(4*j)+151*E1*E1*E1/96*Math.sin(6*j),m=EQUATORIAL_RADIUS/Math.sqrt(1-ECC_SQUARED*Math.sin(k)*Math.sin(k)),n=Math.tan(k)*Math.tan(k),o=ECC_PRIME_SQUARED*Math.cos(k)*Math.cos(k),p=EQUATORIAL_RADIUS*(1-ECC_SQUARED)/Math.pow(1-ECC_SQUARED*Math.sin(k)*Math.sin(k),1.5),q=e/(m*k0),r=k-m*Math.tan(k)/p*(q*q/2-(5+3*n+10*o-4*o*o-9*ECC_PRIME_SQUARED)*q*q*q*q/24+(61+90*n+298*o+45*n*n-252*ECC_PRIME_SQUARED-3*o*o)*q*q*q*q*q*q/720);r*=RAD_2_DEG;var s=(q-(1+2*n+o)*q*q*q/6+(5-2*o+28*n-3*o*o+8*ECC_PRIME_SQUARED+24*n*n)*q*q*q*q*q/120)/Math.cos(k);s=h+s*RAD_2_DEG,d.lat=r,d.lon=s}function USNGtoUTM(a,b,c,d,e,f,g){var h=[1.1,2,2.9,3.8,4.7,5.6,6.5,7.3,8.2,9.1,0,.8,1.7,2.6,3.5,4.4,5.3,6.2,7,7.9],i=[0,2,2,2,4,4,6,6,8,8,0,0,0,2,2,4,4,6,6,6],j=USNGSqEast.indexOf(c),k=1+j%8,l="CDEFGHJKLMNPQRSTUVWX".indexOf(b);if(a%2)var m="ABCDEFGHJKLMNPQRSTUV".indexOf(d);else var m="FGHJKLMNPQRSTUVABCDE".indexOf(d);var n=h[l],o=Number(i[l])+m/10;o<n&&(o+=2),g.N=1e6*o+Number(f)*Math.pow(10,5-f.length),g.E=1e5*k+Number(e)*Math.pow(10,5-e.length),g.zone=a,g.letter=b}function USNGtoLL(a,b){var c=new Object;parseUSNG_str(a,c);var d=new Object;USNGtoUTM(c.zone,c.let,c.sq1,c.sq2,c.east,c.north,d),c.let<"N"&&(d.N-=NORTHING_OFFSET),UTMtoLL(d.N,d.E,c.zone,d),b[0]=d.lat,b[1]=d.lon}function parseUSNG_str(a,b){var d,c=0,e=[],f=[];f=a.toUpperCase();var g=/%20/g;if(e=f.replace(g,""),g=/ /g,e=f.replace(g,""),e.length<7)return alert("This application requires minimum USNG precision of 10,000 meters"),0;b.zone=10*e.charAt(c++)+1*e.charAt(c++),b.let=e.charAt(c++),b.sq1=e.charAt(c++),b.sq2=e.charAt(c++),b.precision=(e.length-c)/2,b.east="",b.north="";for(var d=0;d<b.precision;d++)b.east+=e.charAt(c++);" "==e[c]&&c++;for(var d=0;d<b.precision;d++)b.north+=e.charAt(c++)}function isUSNG(a){var e,d=[];d=a.toUpperCase();var f=/%20/g;return d=d.replace(f,""),f=/ /g,d=d.replace(f,""),d.length>15?0:(e=new RegExp("^[0-9]{2}[CDEFGHJKLMNPQRSTUVWX]$"),d.match(e)?(alert("Input appears to be a UTM zone...more precision is required to display a correct result."),0):(e=new RegExp("^[0-9]{2}[CDEFGHJKLMNPQRSTUVWX][ABCDEFGHJKLMNPQRSTUVWXYZ][ABCDEFGHJKLMNPQRSTUV]([0-9][0-9]){0,5}$"),d.match(e)?d.length<7?(alert(d+" Appears to be a USNG string, but this application requires precision of at least 10,000 meters"),0):d:0))}function LLtoMGRS(a,b,c){var e=LLtoUSNG(a,b,c),f=/ /g;return e.replace(f,"")}function GUsngtoLL(a){var b=[];return USNGtoLL(a,b),new GLatLng(b[0],b[1])}function LLtoUSNG_nad27(a,b,c){var d;return EQUATORIAL_RADIUS=6378206.4,ECC_SQUARED=.006768658,d=LLtoUSNG(a,b,c),EQUATORIAL_RADIUS=6378137,ECC_SQUARED=.006694380023,d+" (NAD27)"}var ngFunctionsPresent=!0,UNDEFINED_STR="undefined",UTMEasting,UTMNorthing,UTMZone,zoneNumber,FOURTHPI=Math.PI/4,DEG_2_RAD=Math.PI/180,RAD_2_DEG=180/Math.PI,BLOCK_SIZE=1e5,IS_NAD83_DATUM=!0,GRIDSQUARE_SET_COL_SIZE=8,GRIDSQUARE_SET_ROW_SIZE=20,EASTING_OFFSET=5e5,NORTHING_OFFSET=1e7,k0=.9996,EQUATORIAL_RADIUS,ECCENTRICTY_SQUARED,ECC_PRIME_SQUARED;IS_NAD83_DATUM?(EQUATORIAL_RADIUS=6378137,ECC_SQUARED=.006694380023):(EQUATORIAL_RADIUS=6378206.4,ECC_SQUARED=.006768658);var ECC_PRIME_SQUARED=ECC_SQUARED/(1-ECC_SQUARED),E1=(1-Math.sqrt(1-ECC_SQUARED))/(1+Math.sqrt(1-ECC_SQUARED)),UTMGzdLetters="NPQRSTUVWX",USNGSqEast="ABCDEFGHJKLMNPQRSTUVWXYZ",USNGSqLetOdd="ABCDEFGHJKLMNPQRSTUV",USNGSqLetEven="FGHJKLMNPQRSTUVABCDE"; 
