/*
 *    Date: 
 *  Author: 
 * Project: 
 *
 * 
 */

/* Modules */
var _nodemailer = require("nodemailer");

/* SMTP transport */
var _transport = null;

/* Mail sender */
var _sender = null;

/*
 * Possible SMTP options are the following:
 * host - hostname of the SMTP server
 * port - port of the SMTP server
 * secure - use SSL (if set to true use corrected port)
 * auth - authentication object as {user:"", pass:""}
 * from - email sender (if not specified use authentication user)
 */
function configure(opt)
{
  _transport = _nodemailer.createTransport(opt);
  _sender = opt.from ? opt.from : (opt.auth && opt.auth.user ? opt.auth.user : "");
}

/*
 * Possible mail option are the following:
 * to - Comma separated list or an array of recipients e-mail addresses
 * cc - Comma separated list or an array of recipients e-mail addresses
 * subject - The subject of the e-mail
 * text - The plaintext version of the message
 *
 * callback is a function with one param: err
 */
function sendMail(option,callback)
{
  if (!option.from)
    option.from = _sender;

  _transport.sendMail(option,function(err,res)
  {
    return callback(err);
  });
}

/*
 * Shut down the connection pool, no more messages can be sent.
 */
function close()
{
  _transport.close();
}

exports.configure = configure;
exports.sendMail = sendMail;
exports.close = close;
